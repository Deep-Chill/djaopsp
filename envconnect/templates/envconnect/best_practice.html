{% extends "envconnect/base_folding_icons.html" %}
{% load static from staticfiles %}

{% block consumption_content %}
<section id="load" class="container-fluid">
	<div class="col-lg-12">
		<div class="row">
			<div class="col-lg-12 col-md-12 col-sm-12">
				<ul class="nav nav-tabs squared-tabs surrounded-tabs">
					<li class="squared-tabs-li text-center first_tab">
						<div class="icon-container" style="width: 100%;">
							{% include "envconnect/_icon.html" with icon=icon %}
						</div>
					</li>
				</ul>
			</div>
		</div>
<div class="row">
	<div class="tab-pane active in" id="box_1">
		<div class="tab-content col-lg-12">
			<div class="tab-pane active" id="tab_{{forloop.counter}}">
				<div class="panel panel-grey panel-cartitem over-radius">
					<div id="{{best_practice.slug}}" class="panel-body">
						<div class="padding_20">
							<h1 class="editable" data-key="title">{{best_practice.title}}</h1>
{% if request|is_broker_manager %}
<div>
<button id="lock" type="submit" class="btn {% if 'locked' in best_practice.tag %}btn-warning{% else %}btn-primary{% endif %} btn-sm" style="margin-bottom:10px;">{% if 'locked' in best_practice.tag %}Re-Open{% else %}Complete{% endif %}</button>
<span>To edit, mouse over the text, click and start typing.</span>
<div class="clearfix" />
</div>
{% endif %}
							<div class="text-justify markdown-description">
								<div class="editable edit-formatted" data-key="text">
{% if best_practice.text %}
{{best_practice.text|safe}}
{% else %}
Content development in progress... To learn more about The
Sustainability Project and how to contribute, please visit
the <a href="{{'about/'|site_prefixed}}">about page &raquo;</a>.
{% endif %}
								</div>
							</div>
							<hr class="featurette-divider">
							{% block follow_vote %}
							{% include "envconnect/follow_vote.html" %}
							{% endblock %}
							{% block comments %}
							{% include "envconnect/comments.html" %}
							{% endblock %}
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</div>
</section>
{% endblock %}

{% block bodyscripts %}
{{block.super}}
{% if request|is_broker_manager %}
<script type="text/javascript" charset="utf-8">
$(document).ready(function(){

	$(".editable").editor({
		baseUrl: "{% url 'page_elements' %}",
		preventBlurOnClick: "#toggle-gallery, .dj-gallery-item"
	});

	$("#lock").click(function (event) {
		var self = $(this);
		var url = "{% url 'page_elements' %}{{best_practice.slug}}/add-tags";
		var locked = (self.text() === "Re-Open");
		if( locked ) {
			url = "{% url 'page_elements' %}{{best_practice.slug}}/remove-tags"
		}
		event.preventDefault();
		$.ajax({
			type: "PUT",
			url: url,
			data: JSON.stringify({"tag": "locked"}),
			datatype: "json",
			contentType: "application/json; charset=utf-8",
			success: function(data) {
				self.toggleClass("btn-warning");
				self.toggleClass("btn-primary");
				self.text(locked ? "Complete" : "Re-Open");
{% with breadcrumbs|previous_to_last as last %}
				window.location = "{{last.2}}";
{% endwith %}
			}
		});
	});
});
</script>
{% endif %}
{% endblock %}
