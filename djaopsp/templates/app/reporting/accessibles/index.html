{% extends "app/reporting/base.html" %}

{% block localheadermeta %}
<title>{{campaign.title}} Responses - {{profile.printable_name}} | Practice Sharing Platform</title>
<meta property="og:image" content="https://djaodjin.com/static/img/og-image.png" />
<meta property="og:title" content="{{campaign.title}} Responses - {{profile.printable_name}} | Practice Sharing Platform" />
<meta property="og:url" content="https://www.tspproject.org/" />
<meta name="description" property="og:description" content="Browse responses to {{campaign.title}}" />
{% endblock %}


{% block reporting_title %}Accessible responses{% endblock %}


{% block reporting_content %}
<reporting-organizations inline-template>
  <div>
    <table class="table table-striped mt-4">
      <thead>
        <tr>
          <th class="sticky-cell sticky-cell-top">
            <div class="sticky-cell-content-container">
              <div class="sticky-cell-content">
              </div>
            </div>
          </th>
          <th class="sticky-cell sticky-cell-top">
            <div class="sticky-cell-content-container">
              <div class="sticky-cell-content">
                {% trans %}Organization/profile{% endtrans %}
                <button class="btn btn-link btn-sort"
                        @click.prevent="sortBy('printable_name')">
                  <i :class="sortIcon('printable_name')"></i>
                </button>
              </div>
            </div>
          </th>
          <th class="sticky-cell sticky-cell-top">
            <div class="sticky-cell-content-container">
              <div class="sticky-cell-content">
                {% trans %}Tags{% endtrans %}
                <button class="btn btn-link btn-sort"
                        @click.prevent="sortBy('printable_name')">
                  <i :class="sortIcon('printable_name')"></i>
                </button>
              </div>
            </div>
          </th>
          <th class="sticky-cell sticky-cell-top"
              v-for="(label, index) in items.labels.slice().reverse()"
              v-show="itemsLoaded && items.results.length > 0" v-cloak>
            <div class="sticky-cell-content-container">
              <div class="sticky-cell-content">
                  [[label]]
              </div>
            </div>
          </th>
          <th class="sticky-cell sticky-cell-top">
            <div class="sticky-cell-content-container">
              <div class="sticky-cell-content">
              </div>
            </div>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="2">
            <div class="input-group input-group-sm">
              <div class="input-group-prepend">
                <span class="input-group-text" id="from-inp"><i class="fa fa-search"></i></span>
              </div>
              <input class="form-control"
                     type="text"
                     placeholder="{% trans %}Type Organization/profile ...{% endtrans %}"
                     v-model="params.q" />
            </div>
          </td>
          <td colspan="8">
            <div class="text-left">
              <button class="btn btn-secondary btn-sm"
                      :disabled="!outdated"
                      @click.prevent="filterList()">{% trans %}Search{% endtrans %}</button>
            </div>
          </td>
        </tr>
        <tr v-show="!itemsLoaded">
          <td colspan="3">
            <h3  class="text-center"><i class="fa fa-refresh fa-spin fa-2x"></i></h3>
          </td>
        </tr>
        <tr v-show="itemsLoaded && items.results.length == 0" v-cloak>
          <td colspan="3">No profile accessible for {{profile}}</td>
        </tr>
        <tr :id="entry.slug"
            :class="entry.supplier_initiated ? 'supplier-initiated' : ''"
            v-for="(entry, index) in items.results"
            v-show="itemsLoaded && items.results.length > 0" v-cloak>
          <!-- profile whose report was requested at some point. -->
          <td>
            <span>[[index + 1]]</span><br />
          </td>
          <td>
            <img class="img-fluid" style="max-height: 1rem;" :src="entry.picture || '{{'/static/img/default-organization.png'|asset}}'"> [[entry.printable_name]]<br />
            <small><a href=""><i class="fa fa-envelope"></i> {% trans %}Contacts{% endtrans %}</a></small>
          </td>
          <td>
            <span class="badge badge-secondary">high impact</span>
            <span class="badge badge-secondary" v-if="index == 3">granted</span><br />
            <small><a href=""><i class="fa fa-edit"></i></a></small>
          </td>
          <td class="text-center" v-for="val in entry.values.slice().reverse()">
            <a :href="val[2]" v-if="val[1] === 'verified'">
              <span class="fa fa-certificate" style="color: yellow;"
                    v-if="val[3] === null"></span>
              <span style="color: yellow;"
                    v-if="val[3] !== null">[[val[3] ]]%</span>
            </a>
            <a :href="val[2]" v-if="val[1] === 'completed'">
              <span class="fa fa-circle" style="color: green;"
                    v-if="val[3] === null"></span>
              <span style="color: green;"
                    v-if="val[3] !== null">[[val[3] ]]%</span>
            </a>
            <i class="fa fa-circle" style="color: red;"
               v-if="val[1] === 'responded'"></i>
            <i class="fa fa-circle" style="color: red;"
               v-if="val[1] === 'declined'"></i>
            <i class="fa fa-circle" style="color: grey;"
               v-if="val[1] === 'no-data'"></i>
            <!-- 2023 verified|completed|requested|no-request -->
          </td>
          <td>
            <button class="btn btn-danger btn-sm" @click.prevent="remove($event, index)" data-trip data-trip-index="3" data-trip-content="<p>Click here to cancel access request.</p>" data-trip-position="s">
              <i class="fa fa-trash-o"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
    {% include "_pagination.html" %}
  </div>
</reporting-organizations>
{% endblock %}
